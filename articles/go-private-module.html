<!doctype html>
<html lang="en" domain="https://thefortunedays.com" v-scope="app">
<head><base href="/"><meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="keywords" content=""><meta name="author" content="Thanh Pham"><meta name="image" content="/static/images/header.jpg"><meta name="description" content="Setting up Go private module behinds corporate proxy"><meta property="og:url" content="https://thefortunedays.com/articles/go-private-module"><meta property="og:title" content="Go Private Module"><meta property="og:type" content="article"><meta property="og:image" content="/static/images/header.jpg"><meta property="og:description" content="Setting up Go private module behinds corporate proxy"><meta property="og:locale" content="en_GB"><meta name="twitter:card" content="summary_large_image"><title>Go Private Module</title><link rel="canonical" href="https://thefortunedays.com/articles/go-private-module"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="preconnect" href="/" crossorigin><link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png"><link rel="apple-touch-icon" href="/static/images/favicon-32x32.png"><link href="/static/css/index.css" rel="stylesheet" rel="preload" as="style"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&family=Spectral&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&family=Spectral&display=swap" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&family=Spectral&display=swap"></noscript><script async defer="defer" src="https://unpkg.com/petite-vue@0.4.1/dist/petite-vue.iife.js"></script><script async defer="defer" src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script><script async defer="defer" src="/static/js/index.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9X9G2YCR2X"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9X9G2YCR2X');</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4025327352745846" crossorigin="anonymous"></script></head>
<body class="min-h-screen body" id="app"><header id="header" class="sticky z-50 bg-white"><nav class="flex justify-between px-2 lg:px-5 py-4 border-b border-gray-100 font-serif"><a href="/" class="flex space-x-2 items-center"><svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2048 2048" class="h-8 w-8"><title>The Fortune Days</title><style>.s1 { fill:black;stroke: url(#g1);stroke-width: 0;stroke-dasharray: 0,0 } 
          .s2 { fill:black;stroke: url(#g2);stroke-width: 0;stroke-dasharray: 0,0 } 
          .s3 { fill:black;stroke: url(#g3);stroke-width: 0;stroke-dasharray: 0,0 } 
          .s4 { fill:black;stroke: url(#g4);stroke-width: 0;stroke-dasharray: 0,0 }</style><g id="logo"><g id="logo"><path id="bk" fill-rule="evenodd" class="s1" d="m1090.5 1071.3l111.5 189.6 232.5-3.8-194.1-332 65.7-113.7 335 575h-501l-119.9-207.3-69.8-120.7-220.2 1.5-113 202.9 385.1-1.9 72.6 125.5h-666.9l257.8-442.6h229.3 139.7l108.8-191.1-119.6-199.1-190.9 333.8h-134.4l325.8-559.4 248.9 427.2-113 195.3z"/><path id="Rectangle 2 copy 3" fill-rule="evenodd" class="s2" d="m950.4 1058.4l-220.2 1.5-113 202.9 385.1-1.9 72.6 125.5h-666.9l257.8-442.6h229.3 139.7z"/><path id="Rectangle 2 copy 4" fill-rule="evenodd" class="s3" d="m1090.5 1071.3l111.5 189.6 232.5-3.8-194.1-332 65.7-113.7 335 575h-501l-119.9-207.3-69.8-120.7z"/><path id="Rectangle 2 copy 5" fill-rule="evenodd" class="s4" d="m1090.5 1071.3l-55.7-127.5 108.8-191.1-119.6-199.1-190.9 333.8h-134.4l325.8-559.4 248.9 427.2-113 195.3z"/></g></g></svg><div :class="showMenu ? 'hidden md:block font-semibold': 'font-semibold'" v-cloak>THE FORTUNE DAYS</div></a><div class="flex space-x-5 md:space-x-8 items-center"><div class="flex space-x-2 text-sm md:text-base" v-show="showMenu" v-cloak><a class="transition duration-500 ease-in-out" href="/">Home</a> <a class="transition duration-500 ease-in-out" href="/articles">Articles</a> <a class="transition duration-500 ease-in-out" href="/about">About</a></div><svg @click="showMenu=!showMenu" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 cursor-pointer"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg></div></nav></header><div class="w-full pb-14"><div class="container w-full max-w-xl mx-auto px-2 pb-10">
    <article class="w-full pt-10 md:pt-14 pb-5">
      <div class="w-full mb-10">
        <h1 class="mb-2 text-3xl lg:text-4xl font-serif font-semibold">Go Private Module</h1>
        <div class="flex justify-between">
          <div class="text-sm lg:text-base font-medium text-gray-600">Thanh Pham / Sun 24 Sep 2023</div>
          <div class="flex space-x-2"></div>
        </div>
      </div>
      <div class="prose prose-img:mb-2 lg:prose-lg prose-img:lg:mb-2 font-serif text-justify">
        <div><p>Sooner or later as a Go developer, you will need to build a module for reusing common code across the applications. If your module is public, that's quite straight forward, just create a public repository in GitHub or GitLab, make sure `go.mod` is defined correctly and you're ready. But if your module is private, there are some steps that need to be done so that Go Module works correctly. This post is all about initializing and setting up a private Go module.</p><h3>Init Module With Git Full Qualify Domain Name</h3><p>Normally you should name your module to match with where your repository is located in your Git server.</p><p>If your your code located at: `https://gitlab.mycompany.com/my-module`, your `go.mod` should be:</p><pre><code>module gitlab.mycompany.com/my-module

go 1.21.0</code></pre><p>Since your module name already included Git full qualify domain name, Go Module know exactly where to download your module, hence you can use the module name directly in other modules:</p><pre><code>module my-application

go 1.21.0

require gitlab.mycompany.com/my-module v0.0.1</code></pre><h3>Init Module With Custom Name</h3><p>If for some reasons, you don't want to include the full qualify domain name in your module name, you can define your module as below:</p><pre><code>module my-module

go 1.21.0</code></pre><p>And to use it, you need to tell Go Module where to download your module. One of the solution is using `replace` directive:</p><pre><code>module my-application

go 1.21.0

require my-module v0.0.1

replace my-module =&gt; gitlab.mycompany.com/my-module v0.0.1</code></pre><p>And if during the development, you want to use local/unpublished code of `my-module` right away in other module for testing, you can also use the `replace` directive to point directly to where the module is located:</p><pre><code>module my-application

go 1.21.0

require my-module v0.0.1

replace my-module =&gt; ../relative/or/absolute/path/to/my-module</code></pre><h3>Local Development</h3><p>To build the code locally, the first step is to tell Go Module that your module is private so that it doesn't use its proxy or checksum database against your module.</p><p>This can be done by using the `GOPRIVATE` environment variable. And if your company Git server doesn't use certified certificates, you might consider to use `GOINSECURE` to ignore certificates verification issues while downloading the module: &nbsp;</p><pre><code>go env -w GOPRIVATE=gitlab.mycompany.com/*
go env -w GOINSECURE=gitlab.mycompany.com/*</code></pre><p>Go Module uses Git under the hood. Hence you need to set up your Git client to allow downloading your module without prompting for username/password. This can be done by set an environment variable named `NETRC` or a file `.netrc` at your home directory:</p><pre><code>machine &lt;url&gt; login &lt;username&gt; password &lt;token&gt;</code></pre><p>After finishing this step, you're ready to `go get` your private module</p><h3>CI/CD</h3><p>You can apply the same steps of local development to the CI/CD pipeline. Below is an example of using GitLab CI:</p><pre><code>variables:
  GOPRIVATE: gitlab.mycompany.com/*
  GOINSECURE: gitlab.mycompany.com/*

build:
  image:
    name: golang:1.21.0
    pull_policy: if-not-present
  before_script:
    - printf &#34;machine gitlab.mycompany.com\nlogin gitlab-ci-token\npassword ${CI_JOB_TOKEN}&#34; &gt; ~/.netrc
  script:
    - go build ./...</code></pre><p>And now your pipeline is ready to download your private module.</p></div>
      </div>
    </article><div class="flex justify-between pt-4 pb-10 border-t border-default font-sans">
    <a aria-label="Post To FaceBook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fthefortunedays.com%2farticles%2fgo-private-module" class="flex flex-col items-center">
      <svg class="h-6 w-6" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
        <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path>
      </svg>
      <span>Post</span>
    </a>
    <a aria-label="Tweet It" href="https://twitter.com/share?url=https%3a%2f%2fthefortunedays.com%2farticles%2fgo-private-module&text=Setting%20up%20Go%20private%20module%20behinds%20corporate%20proxy" class="flex flex-col items-center">
      <svg class="h-6 w-6" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
        <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"></path>
      </svg>
      <span>Tweet</span>
    </a>
    <a aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fthefortunedays.com%2farticles%2fgo-private-module" class="flex flex-col items-center">
      <svg class="h-6 w-6" fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="0" viewBox="0 0 24 24">
        <path stroke="none" d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"></path>
        <circle cx="4" cy="4" r="2" stroke="none"></circle>
      </svg>
      <span>Share</span>
    </a>
  </div><div class="flex flex-col md:flex-row py-8  border-t border-b border-default font-serif">
      <div class="flex md:flex-col w-full md:w-1/5">
        <div class="font-sans">Next In</div>
        <a aria-label="More on this tag" href="/articles/tags/golang" class="font-bold capitalize ml-2 md:mt-2 md:ml-0">golang</a>
      </div>
      <div class="hidden md:flex border-l border-default px-1"></div>
      <div class="w-full md:w-4/5 flex flex-col-reverse md:flex-row">
        <div class="w-full md:w-1/2 mt-2 md:mt-0">
          <a href="/articles/go-map-hash" class="font-semibold capitalize">Go Map Hash</a>
          <p class="mt-2 line-clamp-3 font-serif">How to implement hash code in Go</p>
        </div>
        <a aria-label="Next article" class="mt-2 md:pl-2 md:mt-0 md:w-1/2" href="/articles/go-map-hash">
          <img decoding="async" loading="lazy" width="240" height="120" class="object-cover object-center w-ful" src="/static/images/articles/go-map-hash/go-map-hash.gif" alt="Hash Function" />
        </a>
      </div>
    </div></div></div><footer class="flex w-full font-light justify-center border-t border-gray-100 align-middle"><div class="text-xs text-gray-500 py-8 font-sans">Copyright Â© 2020 - Thanh Pham. All rights reserved.</div></footer><script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "name":"Go Private Module",
      "headline":"Go Private Module",
      "identifier":"go-private-module",
      "keywords":"",
      "image": [],
      "author":"Thanh Pham",
      "genre": "",
      "publisher": {
        "@type": "Organization",
        "name":"The Fortune Days",
        "logo": {
          "@type": "ImageObject",
          "url":"https://thefortunedays.com/static/images/favicon.ico"}
      },
      "url":"https://thefortunedays.com/articles/go-private-module",
      "mainEntityOfPage":"https://thefortunedays.com",
      "datePublished":{"seconds":1695560989,"nanos":762000000},
      "dateModified":{},
      "description":"Setting up Go private module behinds corporate proxy"}
  </script></body>
</html>
