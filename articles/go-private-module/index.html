<!DOCTYPE html><html domain=thefortunedays.com lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="/img/favicon/favicon-192x192.png?hash=735479e2c4" rel=icon type=image/png><meta content=#ff577d name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>Go Private Module</title><meta content="Go Private Module" property=og:title><meta content="How to configure Go private modules behind corporate proxy." name=description><meta content="How to configure Go private modules behind corporate proxy." property=og:description><meta content=summary_large_image name=twitter:card><meta content=@phamthethanh108 name=twitter:site><meta content=@phamthethanh108 name=twitter:creator><meta content=https://thefortunedays.com/img/remote/Z1o6V9l.jpg property=og:image><link href=https://thefortunedays.com/articles/go-private-module/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="The Fortune Days"><link href=/ rel=preconnect crossorigin=""><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Coustard:wght@400;900&family=Lora:ital,wght@0,400..700;1,400..700&family=Montserrat:ital,wght@0,100..900;1,100..900&family=UnifrakturMaguntia&display=swap" rel=stylesheet><script async src="/js/min.js?hash=8db32dcb3a" data-cwv-src="/js/web-vitals.js?hash=a2ed2205a4" defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9X9G2YCR2X"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-9X9G2YCR2X');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>@keyframes neon-blink{44%,46%,98%,to{opacity:1}45%{opacity:.7}99%{opacity:.5}}:root{--primary: black;--primary-dark: black;--text-color: black;--bg-color: white;--nav-bg-color: #fff;--nav-text-color: black;--reading-progress: lightgray;--footer-bg-color: white;--footer-text-color: black;--code-bg: #e2777a;--code: #2d2d2d;--mark: #f9c412;--hr: black;--figcaption: #ccc;--heading-color: black;--post-date: rgb(56, 54, 54);--post-separator: rgb(56, 54, 54);--font-family: 'Lora', sans-serif;--main-width: calc(100vw - 3em)
}main img{content-visibility:auto}article *{scroll-margin-top:50px}header{z-index:1;display:flex;flex-direction:column;align-items:center;padding-top:2em;padding-bottom:2em}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)
  }}html{line-height:1.15;-webkit-text-size-adjust:100%;font-size:14px;color:var(--text-color);background-color:var(--bg-color);text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased}body{margin:0}@media (min-width:320px){html{font-size:14px}}@media (min-width:480px){html{font-size:14px}}@media (min-width:600px){html{font-size:14px}}@media (min-width:801px){html{font-size:14px}}@media (min-width:1025px){html{font-size:16px}}@media (min-width:1281px){html{font-size:16px}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}.apple share-widget div{background-image:url(/img/share-apple.svg)}dialog{background-color:#0a9cf5;z-index:1000;border:.2rem solid #fff;border-radius:1.25rem;padding:1.25em}img[align=left]{width:auto;height:16rem;margin-right:1rem;margin-bottom:1rem}dl{clear:both;display:block!important;margin:0 0 1.5em}#posts li{margin-bottom:.5em}hr{box-sizing:content-box;height:0;overflow:visible;border-bottom:1px solid var(--hr)}pre,samp{font-size:1em}samp{font-family:monospace,monospace}a{background-color:transparent;color:#f9c412;text-decoration:none;color:var(--primary)}abbr[title]{border-bottom:0;text-decoration:underline dotted}b,strong{font-weight:700}small{font-size:80%;color:#ccc}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15}input,optgroup,select,textarea{margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}legend{color:inherit;display:table;max-width:100%;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}h1,h2,h3,h4,h5{margin:3rem 0 1.38rem;line-height:1.3;font-weight:400}h1{font-size:2.074rem}h2{font-size:1.728rem}h3{font-size:1.44rem}h4{font-size:1.2rem}h5{font-size:1rem}body,ol,p,pre,ul{font-size:1rem;line-height:1.6}ol,p,pre,ul{margin-bottom:1.36rem}dt,th{font-weight:600}td,th{border-bottom:1px solid #595959;overflow:auto;padding:.75em;text-align:left;vertical-align:top}thead th{border-bottom:1px solid #f9c412}table{display:table}code,pre,table{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre:has(code:not([class])){background:#2d2d2d}pre code:not([class]){color:#ccc;padding:0;overflow-x:scroll}code,kbd,mark{padding:0 .3em}code,kbd{border-radius:.3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:var(--code-bg);color:var(--code)}mark{background:var(--mark)}h1,h2{font-family:"Coustard"}a:hover{text-decoration:underline}figcaption{color:var(--figcaption);margin-top:.75em;font-size:80%}@media (max-width:767px){fieldset{min-width:0}fieldset *{flex-grow:1;page-break-before:auto}x:-moz-any-link{display:table-cell}}html{font-family:var(--font-family)}form{padding:1.5em 1.5em 0;border:.2rem solid #202020}form small{font-style:italic}fieldset{padding:0;margin:0}fieldset legend{font-size:150%;margin-bottom:.75em}button,input,select,textarea{border-radius:.3em;max-width:100%}input{padding:.75em}textarea{display:inline-block}button+input[type=checkbox],button+input[type=radio],button+label,input+input[type=checkbox],input+input[type=radio],input+label,label+*,select+input[type=checkbox],select+input[type=radio],select+label,textarea+input[type=checkbox],textarea+input[type=radio],textarea+label{page-break-before:always}form,input,select,textarea{margin-bottom:1.5em}textarea{min-height:7.5em;min-width:15em}label{display:inline-block}fieldset>*,figure img{display:block}input,select{display:inline}fieldset>*,form>:not(fieldset){margin-right:.75em}button,input[type=reset],input[type=submit]{background:var(--primary);color:var(--text-color);cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover,input[type=reset]:hover,input[type=submit]:hover{background:var(--primary-dark);color:var(--text-color)}button[disabled],input[type=reset][disabled],input[type=submit][disabled]{background:#e6e6e6;color:#404040;cursor:not-allowed}button:not([disabled]),button[type=submit],input[type=submit]{background:#f9c412;color:#181818}button:not([disabled]):hover,button[type=submit]:hover,input[type=submit]:hover{background:#ba9005;color:#000;background:var(--primary-dark)}input[type=color],input[type=date],input[type=datetime-local],input[type=datetime],input[type=email],input[type=file],input[type=month],input[type=number],input[type=password],input[type=phone],input[type=range],input[type=search],input[type=tel],input[type=text],input[type=time],input[type=url],input[type=week],select,textarea{border:1px solid #595959;padding:.75em}input[type=checkbox],input[type=radio]{flex-grow:0;margin:.75em .375em .75em 0;vertical-align:middle}input[type=checkbox]+label,input[type=radio]+label{page-break-before:avoid}select[multiple]{min-width:15em}*{border:0;box-sizing:border-box}article,img,video{max-width:100%;margin:0 auto}img,video{height:auto}body{font-family:var(--font-family);background:var(--bg-color);color:var(--text-color)}section{margin-left:auto;margin-right:auto;width:900px}main{max-width:70rem;margin:0 auto}footer{background:var(--footer-bg-color);padding:1em;text-align:center;border-top:.5px solid #d3d3d3}footer,footer a{color:var(--footer-text-color)}footer>*{font-family:'Oswald'}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{padding:0 1.5em 4.5em;width:45.5em;min-height:100vh}ol,ul{margin-top:0}li dl,li ol,li ul{margin-bottom:0}dt{padding-top:.75em;padding-left:.75em}dd{padding-bottom:.75em;margin-left:2.25em}dd+dt{border-top:1px solid #f9c412;border-top:1px solid var(--primary)}blockquote{border-left:1px solid #f9c412;padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:3px solid var(--primary)}blockquote footer{background:0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}figure,footer>*{margin:1.5em}code[class*=language-],pre[class*=language-]{color:#ccc;background:0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]{padding:0}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}button:not([disabled]),button[type=submit],input[type=submit]{background:var(--primary)}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.about{min-height:80vh}.about h1,.tags-list h1{font-family:'Coustard';padding-bottom:1em}.tags-list{text-align:center}.tags,.tags-list{min-height:80vh}.tags h1,article h1{text-align:center;padding-bottom:1em}.tags h1,article h1,article h2,h3,h4,h5,h6{font-family:'Coustard'}@media (min-width:600px){.about{min-height:calc(100vh - 360px)}.tags-list{text-align:center}.tags,.tags-list{min-height:calc(100vh - 360px)}}.home .banner{width:100%;margin-bottom:3em;opacity:90%}.post{margin-bottom:30px}.post .title,article h1,article h2,h3,h4,h5,h6{color:var(--heading-color)}.post .title{font-family:"Coustard";font-size:1.125em}.post .title .draft{color:#b8860b}.post .date,.post .description{margin-top:5px;color:var(--text-color)}.post .date{font-size:.75em;color:var(--post-date);text-transform:uppercase}.post .separator{color:var(--post-separator);opacity:.1}blockquote>p{font-size:1.5rem;font-style:italic}blockquote p:last-child{font-size:1.2rem;font-weight:400}header div{padding-bottom:4em}.pagetitle{font-family:"UnifrakturMaguntia";font-size:3em;font-weight:900}.menu,.pagetitle,.pagetitle:hover{text-decoration:none}nav{width:100%}#nav{max-width:45.5em;margin:0 auto;padding:.5em;display:flex;justify-content:center;gap:5px;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3}.menu{padding:5px 10px;font-family:"Coustard"}share-widget div{width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;color:gray}share-widget button{margin:0;background-color:#a9a9a9!important}share-widget button:hover{background-color:#ecbb19!important}share-widget button:active{transform:scale(1.2)}</style><header><div><a href=/ class=pagetitle title=Homepage>The Fortune Days</a></div><nav><div id=nav><a href=/ class=menu>Home</a> <a href=/tags/ class=menu>Tags</a> <a href=/about/ class=menu>About</a></div></nav><dialog id=message></dialog></header><main><article><h1>Go Private Module</h1><p>Sooner or later as a Go developer, you will need to build a module for reusing common code across the applications. If your module is public, that's quite straight forward, just create a public repository in GitHub or GitLab, make sure <code>go.mod</code> is defined correctly and you're ready. But if your module is private, there are some steps that need to be done so that Go Module works correctly. This post is all about initializing and setting up a private Go module.<h2 id=init-module-with-git-full-qualify-domain-name>Init Module With Git Full Qualify Domain Name <a href=#init-module-with-git-full-qualify-domain-name class=direct-link>#</a></h2><p>Normally you should name your module to match with where your repository is located in your Git server.<p>If your your code located at: <code>https://gitlab.mycompany.com/my-module</code>, your <code>go.mod</code> should be:<pre class=language-go><code class=language-go>module gitlab<span class="token punctuation">.</span>mycompany<span class="token punctuation">.</span>com<span class="token operator">/</span>my<span class="token operator">-</span>module<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span></code></pre><p>Since your module name already included Git full qualify domain name, Go Module know exactly where to download your module, hence you can use the module name directly in other modules:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>application<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span><br><br>require gitlab<span class="token punctuation">.</span>mycompany<span class="token punctuation">.</span>com<span class="token operator">/</span>my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span></code></pre><h2 id=init-module-with-custom-name>Init Module With Custom Name <a href=#init-module-with-custom-name class=direct-link>#</a></h2><p>If for some reasons, you don't want to include the full qualify domain name in your module name, you can define your module as below:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>module<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span></code></pre><p>And to use it, you need to tell Go Module where to download your module. One of the solution is using <code>replace</code> directive:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>application<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span><br><br>require my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span><br><br>replace my<span class="token operator">-</span>module <span class="token operator">=</span><span class="token operator">></span> gitlab<span class="token punctuation">.</span>mycompany<span class="token punctuation">.</span>com<span class="token operator">/</span>my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span></code></pre><p>And if during the development, you want to use local/unpublished code of <code>my-module</code> right away in other module for testing, you can also use the <code>replace</code> directive to point directly to where the module is located:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>application<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span><br><br>require my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span><br><br>replace my<span class="token operator">-</span>module <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>relative<span class="token operator">/</span>or<span class="token operator">/</span>absolute<span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>my<span class="token operator">-</span>module</code></pre><h2 id=local-development>Local Development <a href=#local-development class=direct-link>#</a></h2><p>To build the code locally, the first step is to tell Go Module that your module is private so that it doesn't use its proxy or checksum database against your module.<p>This can be done by using the <code>GOPRIVATE</code> environment variable. And if your company Git server doesn't use certified certificates, you might consider to use <code>GOINSECURE</code> to ignore certificates verification issues while downloading the module:<pre class=language-bash><code class=language-bash>go <span class="token function">env</span> -w <span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span>gitlab.mycompany.com/*<br>go <span class="token function">env</span> -w <span class="token assign-left variable">GOINSECURE</span><span class="token operator">=</span>gitlab.mycompany.com/*</code></pre><p>Go Module uses Git under the hood. Hence you need to set up your Git client to allow downloading your module without prompting for username/password. This can be done by set an environment variable named <code>NETRC</code> or a file <code>.netrc</code> at your home directory:<pre class=language-go><code class=language-go>machine <span class="token operator">&lt;</span>url<span class="token operator">></span> login <span class="token operator">&lt;</span>username<span class="token operator">></span> password <span class="token operator">&lt;</span>token<span class="token operator">></span></code></pre><p>After finishing this step, you're ready to <code>go get</code> your private module<h2 id=ci%2Fcd>CI/CD <a href=#ci%2Fcd class=direct-link>#</a></h2><p>You can apply the same steps of local development to the CI/CD pipeline. Below is an example of using GitLab CI:<pre class=language-yaml><code class=language-yaml><span class="token atrule key">variables</span><span class="token punctuation">:</span><br>  <span class="token atrule key">GOPRIVATE</span><span class="token punctuation">:</span> gitlab.mycompany.com/*<br>  <span class="token atrule key">GOINSECURE</span><span class="token punctuation">:</span> gitlab.mycompany.com/*<br><br><span class="token atrule key">build</span><span class="token punctuation">:</span><br>  <span class="token atrule key">image</span><span class="token punctuation">:</span><br>    <span class="token atrule key">name</span><span class="token punctuation">:</span> golang<span class="token punctuation">:</span>1.21.0<br>    <span class="token atrule key">pull_policy</span><span class="token punctuation">:</span> if<span class="token punctuation">-</span>not<span class="token punctuation">-</span>present<br>  <span class="token atrule key">before_script</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> printf "machine gitlab.mycompany.com\nlogin gitlab<span class="token punctuation">-</span>ci<span class="token punctuation">-</span>token\npassword $<span class="token punctuation">{</span>CI_JOB_TOKEN<span class="token punctuation">}</span>" <span class="token punctuation">></span> ~/.netrc<br>  <span class="token atrule key">script</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> go build ./<span class="token punctuation">...</span></code></pre><p>And now your pipeline is ready to download your private module.</p><share-widget><button aria-label=Share href=https://thefortunedays.com/articles/go-private-module/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Go Private Module",
  "image": [],
  "author": "Thanh", 
  "genre": "Blog", 
  "publisher": {
    "@type": "Organization",
    "name": "Thanh",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=735479e2c4"
    }
  },
  "url": "https://thefortunedays.com/articles/go-private-module/",
  "mainEntityOfPage": "https://thefortunedays.com/articles/go-private-module/",
  "datePublished": "2023-09-24",
  "dateModified": "2024-09-24",
  "description": "Sooner or later as a Go developer, you will need to build a module for reusing common code across the applications. If your module is..."
}</script></article></main><footer><a href=/about/ >Thanh</a></footer>