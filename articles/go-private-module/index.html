<!DOCTYPE html><html domain=thefortunedays.com lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="/img/favicon/favicon-192x192.png?hash=735479e2c4" rel=icon type=image/png><meta content=#ff577d name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>Go Private Module</title><meta content="Go Private Module" property=og:title><meta content="How to configure Go private modules behind corporate proxy." name=description><meta content="How to configure Go private modules behind corporate proxy." property=og:description><meta content=summary_large_image name=twitter:card><meta content=@phamthethanh108 name=twitter:site><meta content=@phamthethanh108 name=twitter:creator><meta content=https://thefortunedays.com/img/remote/Z1o6V9l.jpg property=og:image><link href=https://thefortunedays.com/articles/go-private-module/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="The Fortune Days"><link href=/ rel=preconnect crossorigin=""><link href=/fonts/CyberwayRiders.woff2 rel=preload crossorigin="" as=font type=font/woff2><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><script async src="/js/min.js?hash=8db32dcb3a" data-cwv-src="/js/web-vitals.js?hash=4a3c7b61e1" defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9X9G2YCR2X"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-9X9G2YCR2X');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>@keyframes neon-blink{44%,46%,98%,to{opacity:1}45%{opacity:.7}99%{opacity:.5}}:root{--primary: #ff577d;--primary-dark: #ff184c;--text-color: #f5f5f7;--bg-color: #003062;--nav-bg-color: #ff577d;--nav-text-color: #fff;--nav-text-shadow: #00e5ff;--reading-progress: #ff184c;--footer-bg-color: #091833;--footer-text-color: #ff577d;--footer-text-shadow: #00e5ff;--heading-color: #ff577d;--heading-text-shadow: #00e5ff;--box-shadow:
    0 0 0.05vw 0.1vw #e0f7fa,
    0 0 0.1vw 0.2vw #00e5ff,
    0 0 0.3vw 0.2vw #26c6da;--font-family: 'Montserrat', sans-serif;--main-width: calc(100vw - 3em)
}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;padding:1em 1.5em;background:var(--nav-bg-color);color:var(--nav-text-color);font-weight:200;text-align:right;box-shadow:var(--box-shadow)}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)
  }}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-size:14px;color:var(--text-color);background-color:var(--bg-color);text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased}body,share-widget button{margin:0}@media (min-width:320px){html{font-size:14px}}@media (min-width:480px){html{font-size:14px}}@media (min-width:600px){html{font-size:14px}}@media (min-width:801px){html{font-size:14px}}@media (min-width:1025px){html{font-size:16px}}@media (min-width:1281px){html{font-size:17px}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}share-widget div:hover{background-color:var(--primary-dark)}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button:active{transform:scale(1.2)}dialog{background-color:#0a9cf5;z-index:1000;border:.2rem solid #fff;border-radius:1.25rem;padding:1.25em}#nav{z-index:2;position:relative}#reading-progress{z-index:1;background-color:var(--reading-progress);width:100vw;position:absolute;left:0;top:0;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}@font-face{font-display:optional;font-family:'CyberwayRiders';font-weight:100 900;font-style:oblique 0deg 10deg;src:url(/fonts/CyberwayRiders.woff2) format("woff2");font-display:swap}pre{font-size:1em}a{background-color:transparent;color:#f9c412;text-decoration:none;color:var(--primary)}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}h1,h2{margin:3rem 0 1.38rem;line-height:1.3}h1{font-size:2.488rem}h2{font-size:2.074rem}body,p,pre{font-size:1rem;line-height:1.6}p,pre{margin-bottom:1.36rem}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre:has(code:not([class])){background:#2d2d2d}pre code:not([class]){color:#ccc;padding:0;overflow-x:scroll}code{color:var(--code);padding:0 .3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:var(--code-bg)}h1,h2,html{font-family:var(--font-family)}a:hover{text-decoration:underline}button,button:hover{color:var(--text-color)}button,code{border-radius:.3em}button{max-width:100%;background:var(--primary);cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:var(--primary-dark)}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg-color);color:var(--text-color)}header{padding:4em 1.5em 3em;width:37.5em;margin:0 auto;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p{margin-top:0}#nav{display:flex;justify-content:space-between}header nav a{font-weight:700;text-decoration:none;color:var(--nav-text-color);margin-left:1.5em;font-family:'CyberwayRiders';text-shadow:0 0 7px #fff,0 0 42px var(--nav-text-shadow)}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}main{max-width:70rem;margin:0 auto}footer{background:var(--footer-bg-color);padding:3em;text-align:center}footer,footer a{color:var(--footer-text-color)}footer>*{margin:1.5em;font-family:'CyberwayRiders';text-shadow:0 0 7px #fff,0 0 42px var(--footer-text-shadow)}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:100%;padding:0 1.5em 4.5em;width:37.5em;margin:0 auto;min-height:100vh}code[class*=language-],pre[class*=language-]{color:#ccc;background:0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]{padding:0}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.tag{color:#e2777a}.token.function,.token.number{color:#f08d49}.token.property{color:#f8c555}.token.atrule,.token.keyword{color:#cc99cd}.token.variable{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.inserted{color:green}.about,.tags{min-height:80vh}.about h1{font-family:'CyberwayRiders';padding-bottom:1em}.tags h1,article h1{padding-bottom:1em;text-align:center}article h1{text-shadow:0 0 7px #fff,0 0 10px #fff,0 0 21px #fff,0 0 42px var(--heading-text-shadow),0 0 82px var(--heading-text-shadow),0 0 92px var(--heading-text-shadow)}.post .title,article h1,article h2{color:var(--heading-color)}.tags h1,article h1,article h2{font-family:'CyberwayRiders'}article h2{text-shadow:0 0 7px #fff,0 0 10px #fff,0 0 21px #fff,0 0 42px var(--heading-text-shadow),0 0 82px var(--heading-text-shadow)}@media (min-width:600px){.about,.tags{min-height:calc(100vh - 360px)}}.post{margin-bottom:30px}.post .title{font-weight:700}.post .description{margin-top:5px;color:var(--text-color)}</style><header><nav><div id=nav><div><a href=/ title=Homepage>The Fortune Days</a></div><div><a href=/tags/ >Tags</a> <a href=/about/ >About</a></div></div><div id=reading-progress aria-hidden=true></div></nav><dialog id=message></dialog></header><main><article><h1>Go Private Module</h1><p>Sooner or later as a Go developer, you will need to build a module for reusing common code across the applications. If your module is public, that's quite straight forward, just create a public repository in GitHub or GitLab, make sure <code>go.mod</code> is defined correctly and you're ready. But if your module is private, there are some steps that need to be done so that Go Module works correctly. This post is all about initializing and setting up a private Go module.<h2 id=init-module-with-git-full-qualify-domain-name>Init Module With Git Full Qualify Domain Name <a href=#init-module-with-git-full-qualify-domain-name class=direct-link>#</a></h2><p>Normally you should name your module to match with where your repository is located in your Git server.<p>If your your code located at: <code>https://gitlab.mycompany.com/my-module</code>, your <code>go.mod</code> should be:<pre class=language-go><code class=language-go>module gitlab<span class="token punctuation">.</span>mycompany<span class="token punctuation">.</span>com<span class="token operator">/</span>my<span class="token operator">-</span>module<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span></code></pre><p>Since your module name already included Git full qualify domain name, Go Module know exactly where to download your module, hence you can use the module name directly in other modules:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>application<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span><br><br>require gitlab<span class="token punctuation">.</span>mycompany<span class="token punctuation">.</span>com<span class="token operator">/</span>my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span></code></pre><h2 id=init-module-with-custom-name>Init Module With Custom Name <a href=#init-module-with-custom-name class=direct-link>#</a></h2><p>If for some reasons, you don't want to include the full qualify domain name in your module name, you can define your module as below:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>module<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span></code></pre><p>And to use it, you need to tell Go Module where to download your module. One of the solution is using <code>replace</code> directive:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>application<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span><br><br>require my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span><br><br>replace my<span class="token operator">-</span>module <span class="token operator">=</span><span class="token operator">></span> gitlab<span class="token punctuation">.</span>mycompany<span class="token punctuation">.</span>com<span class="token operator">/</span>my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span></code></pre><p>And if during the development, you want to use local/unpublished code of <code>my-module</code> right away in other module for testing, you can also use the <code>replace</code> directive to point directly to where the module is located:<pre class=language-go><code class=language-go>module my<span class="token operator">-</span>application<br><br><span class="token keyword">go</span> <span class="token number">1.21</span><span class="token number">.0</span><br><br>require my<span class="token operator">-</span>module v0<span class="token punctuation">.</span><span class="token number">0.1</span><br><br>replace my<span class="token operator">-</span>module <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>relative<span class="token operator">/</span>or<span class="token operator">/</span>absolute<span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>my<span class="token operator">-</span>module</code></pre><h2 id=local-development>Local Development <a href=#local-development class=direct-link>#</a></h2><p>To build the code locally, the first step is to tell Go Module that your module is private so that it doesn't use its proxy or checksum database against your module.<p>This can be done by using the <code>GOPRIVATE</code> environment variable. And if your company Git server doesn't use certified certificates, you might consider to use <code>GOINSECURE</code> to ignore certificates verification issues while downloading the module:<pre class=language-bash><code class=language-bash>go <span class="token function">env</span> -w <span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span>gitlab.mycompany.com/*<br>go <span class="token function">env</span> -w <span class="token assign-left variable">GOINSECURE</span><span class="token operator">=</span>gitlab.mycompany.com/*</code></pre><p>Go Module uses Git under the hood. Hence you need to set up your Git client to allow downloading your module without prompting for username/password. This can be done by set an environment variable named <code>NETRC</code> or a file <code>.netrc</code> at your home directory:<pre class=language-go><code class=language-go>machine <span class="token operator">&lt;</span>url<span class="token operator">></span> login <span class="token operator">&lt;</span>username<span class="token operator">></span> password <span class="token operator">&lt;</span>token<span class="token operator">></span></code></pre><p>After finishing this step, you're ready to <code>go get</code> your private module<h2 id=ci%2Fcd>CI/CD <a href=#ci%2Fcd class=direct-link>#</a></h2><p>You can apply the same steps of local development to the CI/CD pipeline. Below is an example of using GitLab CI:<pre class=language-yaml><code class=language-yaml><span class="token atrule key">variables</span><span class="token punctuation">:</span><br>  <span class="token atrule key">GOPRIVATE</span><span class="token punctuation">:</span> gitlab.mycompany.com/*<br>  <span class="token atrule key">GOINSECURE</span><span class="token punctuation">:</span> gitlab.mycompany.com/*<br><br><span class="token atrule key">build</span><span class="token punctuation">:</span><br>  <span class="token atrule key">image</span><span class="token punctuation">:</span><br>    <span class="token atrule key">name</span><span class="token punctuation">:</span> golang<span class="token punctuation">:</span>1.21.0<br>    <span class="token atrule key">pull_policy</span><span class="token punctuation">:</span> if<span class="token punctuation">-</span>not<span class="token punctuation">-</span>present<br>  <span class="token atrule key">before_script</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> printf "machine gitlab.mycompany.com\nlogin gitlab<span class="token punctuation">-</span>ci<span class="token punctuation">-</span>token\npassword $<span class="token punctuation">{</span>CI_JOB_TOKEN<span class="token punctuation">}</span>" <span class="token punctuation">></span> ~/.netrc<br>  <span class="token atrule key">script</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> go build ./<span class="token punctuation">...</span></code></pre><p>And now your pipeline is ready to download your private module.</p><share-widget><button aria-label=Share href=https://thefortunedays.com/articles/go-private-module/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Go Private Module",
  "image": [],
  "author": "Thanh", 
  "genre": "Blog", 
  "publisher": {
    "@type": "Organization",
    "name": "Thanh",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=735479e2c4"
    }
  },
  "url": "https://thefortunedays.com/articles/go-private-module/",
  "mainEntityOfPage": "https://thefortunedays.com/articles/go-private-module/",
  "datePublished": "2023-09-24",
  "dateModified": "2024-09-24",
  "description": "Sooner or later as a Go developer, you will need to build a module for reusing common code across the applications. If your module is..."
}</script></article></main><footer><a href=/about/ >Thanh</a></footer>