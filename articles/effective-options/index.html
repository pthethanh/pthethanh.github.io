<!DOCTYPE html><html domain=thefortunedays.com lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="/img/favicon/favicon-192x192.png?hash=735479e2c4" rel=icon type=image/png><meta content=#ff577d name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>Effective Options</title><meta content="Effective Options" property=og:title><meta content="Summary: Organizing options in API is very important. We can use setters or builders, but options as functions and options as an interface..." name=description><meta content="Summary: Organizing options in API is very important. We can use setters or builders, but options as functions and options as an interface..." property=og:description><meta content=summary_large_image name=twitter:card><meta content=@phamthethanh108 name=twitter:site><meta content=@phamthethanh108 name=twitter:creator><meta content=https://thefortunedays.com/img/remote/Z1o6V9l.jpg property=og:image><link href=https://thefortunedays.com/articles/effective-options/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="The Fortune Days"><link href=/ rel=preconnect crossorigin=""><link href=/fonts/CyberwayRiders.woff2 rel=preload crossorigin="" as=font type=font/woff2><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><script async src="/js/min.js?hash=8db32dcb3a" data-cwv-src="/js/web-vitals.js?hash=4a3c7b61e1" defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9X9G2YCR2X"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-9X9G2YCR2X');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary: #ff577d;--primary-dark:#ff184c;--text-color: #F5F5F7;--bg-color: 	#003062;--nav-bg-color: #ff577d;--nav-text-color: #fff;--footer-bg-color: #091833;--footer-text-color: #999;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{position:fixed;padding:.575em 1.5em;background:var(--nav-bg-color);color:var(--nav-text-color);font-weight:200;text-align:right}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:10px;height:10px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:#0a9cf5;z-index:1000}#nav{z-index:2;position:relative}#reading-progress,header nav{z-index:1;width:100vw;left:0;top:0}#reading-progress{background-color:var(--primary);position:absolute;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}@font-face{font-display:optional;font-family:"CyberwayRiders";font-weight:100 900;font-style:oblique 0deg 10deg;src:url(/fonts/CyberwayRiders.woff2) format("woff2");font-display:swap}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-size:17.5px}@media (max-width:768px){html{font-size:14px}}pre{font-size:1em}a{background-color:transparent;color:#f9c412;text-decoration:none;color:var(--primary)}strong{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}summary{display:list-item}h1,h3{margin:3rem 0 1.38rem;line-height:1.3}h1{font-size:2.488rem}h3{font-size:1.728rem}body,p,pre{font-size:1rem;line-height:1.6}p,pre{margin-bottom:1.36rem}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre:has(code:not([class])){background:#2d2d2d}pre code:not([class]){color:#ccc;padding:0;overflow-x:scroll}button,code{border-radius:.3em}code{color:#e2777a;padding:0 .3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d}h1,h3{font-family:var(--font-family)}a:hover{text-decoration:underline}html{font-family:"Montserrat",sans-serif;--font-family: "Montserrat", sans-serif}button{max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body,header nav a{font-family:var(--font-family)}body{background:var(--bg-color);color:var(--text-color)}header{padding:4em 1.5em 3em;width:37.5em;margin:0 auto;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p{margin-top:0}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;color:var(--nav-text-color);margin-left:1.5em;font-family:'CyberwayRiders';text-shadow:0 0 7px #fff,0 0 42px #0a9cf5}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}main{max-width:70rem;margin:0 auto}footer{background:var(--footer-bg-color);color:var(--footer-text-color);padding:3em;text-align:center}footer>*{margin:1.5em;font-family:'CyberwayRiders';text-shadow:0 0 7px #fff,0 0 42px #0a9cf5}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:100%;padding:1.5em;width:37.5em;margin:0 auto;min-height:100vh}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]{padding:0}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.tag{color:#e2777a}.token.boolean,.token.function,.token.number{color:#f08d49}.token.property{color:#f8c555}.token.builtin,.token.important,.token.keyword{color:#cc99cd}.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.important{font-weight:700}.token.inserted{color:green}.about,.tags{min-height:80vh}.about h1{padding-bottom:1em}article h1{text-shadow:0 0 7px #fff,0 0 42px #0a9cf5}.about h1,.tags h1,article h1,h3{font-family:'CyberwayRiders'}.tags h1,article h1{padding-bottom:1em;text-align:center}h3{text-shadow:0 0 7px #fff,0 0 42px #0a9cf5}@media (min-width:600px){.about,.tags{min-height:calc(100vh - 360px)}}</style><header><nav><div id=nav><h1><a href=/ title=Homepage>The Fortune Days</a></h1><a href=/tags/ >Tags</a> <a href=/about/ >About</a></div><div id=reading-progress aria-hidden=true></div></nav><dialog id=message></dialog></header><main><article><h1>Effective Options</h1><p><strong>Summary</strong>: Organizing options in API is very important. We can use setters or builders, but options as functions and options as an interface are better approaches. They are much more beautiful , flexible and easier to use for the end users.<p>When building a library, we normally try to think how the other developers would use our code and try to provide as many APIs as possible. But sometimes, exposing too many APIs would be very confusing. Or even worse, we failed to provide what our users need, but exposing too many APIs that they don't even need. Hence organizing what we expose and how they should be exposed is really important.<p>Normally, what we expose to the end users are either constructors or methods. Some parameters are required and some are optional. Since we want to expose as many APIs as we can for the end users, we will end up having a lot of variants of the same API.<p>Consider the struct below, where <code>host</code> is required but others are optional:<pre class=language-go><code class=language-go><span class="token keyword">type</span> Cache <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>	host         <span class="token builtin">string</span><br>	username     <span class="token builtin">string</span><br>	password     <span class="token builtin">string</span><br>	readTimeout  time<span class="token punctuation">.</span>Duration<br>	writeTimeout time<span class="token punctuation">.</span>Duration<br><span class="token punctuation">}</span></code></pre><p>The easiest way is to expose everything in 1 single constructor, but it's very confusing for users since it's hard to know which ones are required and which ones are optional. Hence we might end up having multiple versions of the constructor as below:<pre class=language-go><code class=language-go><span class="token function">New</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token function">New</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">,</span> readTimeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token function">New</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token function">New</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">,</span> readTimeout<span class="token punctuation">,</span> writeTimeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token operator">...</span><span class="token punctuation">.</span></code></pre><p>Unfortunately, Go doesn't support method overloading, hence we have to give each of them a different names:<pre class=language-go><code class=language-go><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token keyword">func</span> <span class="token function">NewWithReadTimeout</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">,</span> readTimeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token keyword">func</span> <span class="token function">NewWithUserPass</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token keyword">func</span> <span class="token function">NewWithUserPassAndTimeouts</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">,</span> readTimeout<span class="token punctuation">,</span> writeTimeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token operator">...</span><span class="token punctuation">.</span></code></pre><p>Imagine having 20 optional parameters, naming them is really a nightmare and we might fall into some really bad names. We definitely need a better approach, and some one might suggest using setters.<h3 id=setters>Setters <a href=#setters class=direct-link>#</a></h3><p>With setters, we can improve it a little bit to distinguish the required and optional parameters by putting the required parameters in the constructor <code>New</code> and other optional parameters can be provided by setters. The below block of code show how nice the code is with the setters approach:<pre class=language-go><code class=language-go><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Cache<br><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token function">SetUserPass</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> pass <span class="token builtin">string</span><span class="token punctuation">)</span><br><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token function">SetReadTimeout</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span><br><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token function">SetWriteTimeout</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span></code></pre><p><a href=https://play.golang.org/p/Vk_QyLaUR65>Playground</a><p>The code looks just beautiful! We can see setters can resolve the problem we have previously with our constructors. But how can we apply it to functions and methods? Consider the below method of the <code>Cache</code> service, where the <code>ttl</code> is optional.<pre class=language-go><code class=language-go><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token function">Set</span><span class="token punctuation">(</span>k <span class="token builtin">string</span><span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> ttl time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token builtin">error</span></code></pre><p>The API looks OK but there is just one thing ugly. That is even if you don't want to use TTL, you still need to pass a value into the function. What bothers the developer is that he doesn't know whether he should pass -1, or 0 in case he doesn't want his data to be expired. This can be addressed with good documentation or even by adding 2 version of the method:<pre class=language-go><code class=language-go><span class="token function">Set</span><span class="token punctuation">(</span>k <span class="token builtin">string</span><span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span><br><span class="token function">SetWithTTL</span><span class="token punctuation">(</span>k <span class="token builtin">string</span><span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> ttl time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token builtin">error</span></code></pre><p>But what if we have many options besides TTL? For example, Set command can be able to use its own token for authentication? This solution would lead us to defining a lot of variants of the set commands like what we faced with our constructor.<p>One solution to address the above problem is provide them a parameter struct where the developer can set the parameters he needs. Apply the same approach as what we have done for constructors:<pre class=language-go><code class=language-go><span class="token keyword">type</span> SetRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>	k   <span class="token builtin">string</span><br>	v   <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><br>	ttl time<span class="token punctuation">.</span>Duration<br>	tok <span class="token builtin">string</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span>k <span class="token builtin">string</span><span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">*</span>SetRequest <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token operator">&</span>SetRequest<span class="token punctuation">{</span><br>		k<span class="token punctuation">:</span> k<span class="token punctuation">,</span><br>		v<span class="token punctuation">:</span> v<span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>SetRequest<span class="token punctuation">)</span> <span class="token function">SetTTL</span><span class="token punctuation">(</span>ttl time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	r<span class="token punctuation">.</span>ttl <span class="token operator">=</span> ttl<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>SetRequest<span class="token punctuation">)</span> <span class="token function">SetToken</span><span class="token punctuation">(</span>tok <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	r<span class="token punctuation">.</span>tok <span class="token operator">=</span> tok<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token function">Set</span><span class="token punctuation">(</span>r <span class="token operator">*</span>SetRequest<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><br>	<span class="token comment">// TODO implement me.</span><br>	<span class="token comment">// if r.ttl > 0 {...}</span><br>	<span class="token comment">// if r.tok != "" {...}</span><br>	<span class="token keyword">return</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre><p>And this is how our end users use it:<pre class=language-go><code class=language-go>c <span class="token operator">:=</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"localhost:8000"</span><span class="token punctuation">)</span><br>c<span class="token punctuation">.</span><span class="token function">SetUserPass</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">)</span><br>c<span class="token punctuation">.</span><span class="token function">SetReadTimeout</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br><br><span class="token comment">// set with TTL only</span><br>r <span class="token operator">:=</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span><br>r<span class="token punctuation">.</span><span class="token function">SetTTL</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><br><br><span class="token comment">// set with ttl and token</span><br>r1 <span class="token operator">:=</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><br>r1<span class="token punctuation">.</span><span class="token function">SetTTL</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br>r1<span class="token punctuation">.</span><span class="token function">SetToken</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span></code></pre><p><a href=https://play.golang.org/p/az5mODuwnAy>Playground</a><p>The above code is OK but not really beautiful, since we have to create a new SetRequest and set its properties in separate lines which sometimes I feel so uncomfortable to do. We can do it even better, with builders.<h3 id=builders>Builders <a href=#builders class=direct-link>#</a></h3><p>The idea of builders is quite simple, a setter of a struct return itself:<pre class=language-go><code class=language-go><span class="token keyword">func</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span>k <span class="token builtin">string</span><span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">*</span>SetRequest <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token operator">&</span>SetRequest<span class="token punctuation">{</span><br>		k<span class="token punctuation">:</span> k<span class="token punctuation">,</span><br>		v<span class="token punctuation">:</span> v<span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>SetRequest<span class="token punctuation">)</span> <span class="token function">SetTTL</span><span class="token punctuation">(</span>ttl time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">*</span>SetRequest <span class="token punctuation">{</span><br>	r<span class="token punctuation">.</span>ttl <span class="token operator">=</span> ttl<br>	<span class="token keyword">return</span> r<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>SetRequest<span class="token punctuation">)</span> <span class="token function">SetToken</span><span class="token punctuation">(</span>tok <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>SetRequest <span class="token punctuation">{</span><br>	r<span class="token punctuation">.</span>tok <span class="token operator">=</span> tok<br>	<span class="token keyword">return</span> r<br><span class="token punctuation">}</span></code></pre><p>The same thing can be applied to constructor. And here is how we use it:<pre class=language-go><code class=language-go>c <span class="token operator">:=</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"localhost:8000"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetUserPass</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetReadTimeout</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br><br><span class="token comment">// set with TTL only</span><br>r <span class="token operator">:=</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTTL</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><br><br><span class="token comment">// set with ttl and token</span><br>r1 <span class="token operator">:=</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTTL</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetToken</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span></code></pre><p><a href=https://play.golang.org/p/a8Gsb4PGAYy>Playground</a><p>The above code looks just beautiful. But there is still one thing I don't really like: that is the prefix "Set" before every single setter. Sometimes I just remove the prefix "Set" from the builders' names, but someone will argue that it violates the name convention. To be honest, in case of a builder, sometimes I don't care and just remove the prefix from the names to make it more beautiful when using:<pre class=language-go><code class=language-go>c <span class="token operator">:=</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"localhost:8000"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UserPass</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadTimeout</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br><br><span class="token comment">// set with TTL only</span><br>r <span class="token operator">:=</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TTL</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><br><br><span class="token comment">// set with ttl and token</span><br>r1 <span class="token operator">:=</span> <span class="token function">NewSetRequest</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TTL</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Token</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span></code></pre><p><a href=https://play.golang.org/p/vwo3N8jMjWv>Playground</a><p>It looks better but to be honest, I don't really like constructing request param and setting everything like that. We can do it better with options as a function.<h3 id=options-as-functions>Options As Functions <a href=#options-as-functions class=direct-link>#</a></h3><p>The idea of options as functions is pretty simple, options are setting up via functions. We force people to provide required parameters directly in the constructor or directly in the method/function, and optionally provide the advanced options using variadic parameters.<p>Instead of using setters, we will use functions for setting up the struct, here is how we do with the constructor, the same can be applied for methods/functions as well:<pre class=language-go><code class=language-go><span class="token keyword">type</span> Option <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>Cache<span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">,</span> opts <span class="token operator">...</span>Option<span class="token punctuation">)</span> <span class="token operator">*</span>Cache <span class="token punctuation">{</span><br>	c <span class="token operator">:=</span> <span class="token operator">&</span>Cache<span class="token punctuation">{</span>host<span class="token punctuation">:</span> host<span class="token punctuation">}</span><br>	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> opt <span class="token operator">:=</span> <span class="token keyword">range</span> opts <span class="token punctuation">{</span><br>		<span class="token function">opt</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br>	<span class="token keyword">return</span> c<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">UserPass</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> pass <span class="token builtin">string</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		c<span class="token punctuation">.</span>username <span class="token operator">=</span> user<br>		c<span class="token punctuation">.</span>password <span class="token operator">=</span> pass<br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">ReadTimeout</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> Option <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		c<span class="token punctuation">.</span>readTimeout <span class="token operator">=</span> d<br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">WriteTimeout</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> Option <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		c<span class="token punctuation">.</span>writeTimeout <span class="token operator">=</span> d<br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p><a href=https://go.dev/play/p/HLkzdwq6LVF>Playground</a><p>And here is how we use it:<pre class=language-go><code class=language-go>c <span class="token operator">:=</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"localhost:8000"</span><span class="token punctuation">,</span> <span class="token function">UserPass</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ReadTimeout</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token function">TTL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token function">TTL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Token</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Just simply beautiful! No more confusing, required parameters are forced to provide, optional parameters are provided as needed.<p>I think this approach is simple enough to implement and I'm currently using it for production code. But there is still another interesting approach, that is to provide options as an interface.<h3 id=options-as-an-interface>Options As An Interface <a href=#options-as-an-interface class=direct-link>#</a></h3><p>The idea of options as an interface is that everything can be considered as an option if it implements our option interface, so instead of using functions, we will use interface as following:<pre class=language-go><code class=language-go><span class="token keyword">type</span> Option <span class="token keyword">interface</span> <span class="token punctuation">{</span><br>	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token operator">*</span>Cache<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> optionFunc <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>Cache<span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>f optionFunc<span class="token punctuation">)</span> <span class="token function">apply</span><span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token function">f</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">,</span> opts <span class="token operator">...</span>Option<span class="token punctuation">)</span> <span class="token operator">*</span>Cache <span class="token punctuation">{</span><br>	c <span class="token operator">:=</span> <span class="token operator">&</span>Cache<span class="token punctuation">{</span>host<span class="token punctuation">:</span> host<span class="token punctuation">}</span><br>	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> opt <span class="token operator">:=</span> <span class="token keyword">range</span> opts <span class="token punctuation">{</span><br>		opt<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br>	<span class="token keyword">return</span> c<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">UserPass</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> pass <span class="token builtin">string</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token function">optionFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		c<span class="token punctuation">.</span>username <span class="token operator">=</span> user<br>		c<span class="token punctuation">.</span>password <span class="token operator">=</span> pass<br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">ReadTimeout</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> Option <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token function">optionFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		c<span class="token punctuation">.</span>readTimeout <span class="token operator">=</span> d<br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">WriteTimeout</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> Option <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token function">optionFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>Cache<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		c<span class="token punctuation">.</span>writeTimeout <span class="token operator">=</span> d<br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p><a href=https://play.golang.org/p/v25vpjS_-Gs>Playground</a><p>This approach produces the same APIs for the end users as the previous one:<pre class=language-go><code class=language-go>c <span class="token operator">:=</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"localhost:8000"</span><span class="token punctuation">,</span> <span class="token function">UserPass</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ReadTimeout</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token function">TTL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token function">TTL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Token</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><a href=https://play.golang.org/p/v25vpjS_-Gs>Playground</a><p>Although this approach looks a little bit more complicated than the options as functions approach, but it uses an interface hence it will be more flexible for end users to extend our library to have more customized options as their needs.<h3 id=summary>Summary <a href=#summary class=direct-link>#</a></h3><p>All the provided above approaches proved that everyone can write beautiful APIs with just a little effort. Some of you might like <code>builders</code>, but I would suggest you use <code>options as functions</code> or <code>options as an interface</code> since they are more beautiful and more flexible than the previous ones.<p>For more examples, look at packages <a href=https://github.com/pthethanh/micro/tree/master/cache>cache</a>, <a href=https://github.com/pthethanh/micro/tree/master/broker>broker</a> or <a href=https://github.com/pthethanh/micro/tree/master/server>server</a> of my <a href=https://github.com/pthethanh/micro>micro</a> toolkit.</p><share-widget><button aria-label=Share href=https://thefortunedays.com/articles/effective-options/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Effective Options",
  "image": [],
  "author": "Thanh", 
  "genre": "Blog", 
  "publisher": {
    "@type": "Organization",
    "name": "Thanh",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=735479e2c4"
    }
  },
  "url": "https://thefortunedays.com/articles/effective-options/",
  "mainEntityOfPage": "https://thefortunedays.com/articles/effective-options/",
  "datePublished": "2021-11-07",
  "dateModified": "2024-09-20",
  "description": "Summary: Organizing options in API is very important. We can use setters or builders, but options as functions and options as an interface..."
}</script></article></main><footer><a href=/about/ >Thanh</a></footer>